{"version":3,"file":"index.min.js","sources":["../index.js"],"sourcesContent":["\n'use strict'\n\n// 日期的格式： 2019-11-11\nconst PATTERN_DATE = /^\\d{4}\\-\\d{2}\\-\\d{2}$/\n// 日期时间的格式：2019-11-11 11:11:11\nconst PATTERN_DATE_TIME = /^\\d{4}\\-\\d{2}\\-\\d{2} \\d{2}:\\d{2}:\\d{2}$/\n\n// 获取变量类型，返回小写格式\nfunction getType(value) {\n  return Object.prototype.toString.call(value).toLowerCase().slice(8, -1)\n}\n\nfunction extend(source, props) {\n  for (let key in props) {\n    source[key] = props[key]\n  }\n}\n\nexport function checkInteger(rule, value) {\n  if (getType(value) !== 'number' || value % 1 !== 0) {\n    return 'type'\n  }\n\n  if (rule.hasOwnProperty('min') && value < rule.min) {\n    return 'min'\n  }\n\n  if (rule.hasOwnProperty('max') && value > rule.max) {\n    return 'max'\n  }\n}\n\nexport function checkNumber(rule, value) {\n  if (getType(value) !== 'number' || isNaN(value)) {\n    return 'type'\n  }\n\n  if (rule.hasOwnProperty('min') && value < rule.min) {\n    return 'min'\n  }\n\n  if (rule.hasOwnProperty('max') && value > rule.max) {\n    return 'max'\n  }\n}\n\nexport function checkString(rule, value) {\n\n  if (getType(value) !== 'string') {\n    return 'type'\n  }\n\n  if (value === '') {\n    // 是否允许为空，默认不允许\n    if (rule.empty === true) {\n      return\n    }\n    else {\n      return 'empty'\n    }\n  }\n\n  if (rule.hasOwnProperty('min') && value.length < rule.min) {\n    return 'min'\n  }\n\n  if (rule.hasOwnProperty('max') && value.length > rule.max) {\n    return 'max'\n  }\n\n  if (rule.hasOwnProperty('pattern')\n    && !rule.pattern.test(value)\n  ) {\n    return 'pattern'\n  }\n\n}\n\nexport function checkBoolean(rule, value) {\n\n  if (getType(value) !== 'boolean') {\n    return 'type'\n  }\n\n  if (rule.hasOwnProperty('value')\n    && rule.value !== value\n  ) {\n    return 'value'\n  }\n\n}\n\nexport function checkEnum(rule, value) {\n  if (rule.values.indexOf(value) < 0) {\n    return 'type'\n  }\n}\n\nexport function checkArray(rule, value) {\n\n  if (!value || getType(value) !== 'array') {\n    return 'type'\n  }\n\n  const { length } = value\n\n  if (rule.hasOwnProperty('min') && length < rule.min) {\n    return 'min'\n  }\n\n  if (rule.hasOwnProperty('max') && length > rule.max) {\n    return 'max'\n  }\n\n  const { itemType } = rule\n  if (!itemType) {\n    return\n  }\n\n  for (let i = 0; i < length; i++) {\n    if (getType(value[ i ]) !== itemType) {\n      return 'itemType'\n    }\n  }\n\n}\n\nexport function checkObject(rule, value) {\n  if (!value || getType(value) !== 'object') {\n    return 'type'\n  }\n}\n\nexport function checkDate(rule, value) {\n\n  let props = {\n    type: 'string',\n    pattern: PATTERN_DATE,\n  }\n\n  let newRule = {}\n  extend(newRule, rule)\n  extend(newRule, props)\n\n  return checkString(newRule, value)\n\n}\n\nexport function checkDateTime(rule, value) {\n\n  let props = {\n    type: 'string',\n    pattern: PATTERN_DATE_TIME,\n  }\n\n  let newRule = {}\n  extend(newRule, rule)\n  extend(newRule, props)\n\n  return checkString(newRule, value)\n\n}\n\nexport class Validator {\n\n  constructor() {\n    this.rules = {\n      int: checkInteger,\n      integer: checkInteger,\n      number: checkNumber,\n      string: checkString,\n      bool: checkBoolean,\n      boolean: checkBoolean,\n      enum: checkEnum,\n      array: checkArray,\n      object: checkObject,\n      date: checkDate,\n      dateTime: checkDateTime,\n    }\n    this.messages = { }\n  }\n\n  add(name, handler, messages) {\n\n    if (getType(name) === 'object') {\n      extend(this.rules, name)\n      if (getType(handler) === 'object') {\n        extend(this.messages, handler)\n      }\n    }\n    else {\n      this.rules[ name ] = handler\n      this.messages[ name ] = messages\n    }\n\n  }\n\n  validate(data, rules, messages) {\n\n    const errors = { }\n\n    for (let key in rules) {\n\n      let rule = rules[ key ]\n\n      switch (getType(rule)) {\n        case 'string':\n          rule = {\n            type: rule,\n          }\n          break\n\n        case 'array':\n          rule = {\n            type: 'enum',\n            values: rule,\n          }\n          break\n\n        case 'regexp':\n          rule = {\n            type: 'string',\n            pattern: rule,\n          }\n          break\n      }\n\n      if (getType(rule) !== 'object' || !rule.type) {\n        throw new Error(`${key}'s rule is not found.`)\n      }\n\n      let errorReason\n\n      if (data.hasOwnProperty(key)) {\n        errorReason = this.rules[ rule.type ](rule, data[ key ], data)\n      }\n      else {\n        // 默认必传\n        if (rule.required !== false) {\n          errorReason = 'required'\n        }\n        else {\n          continue\n        }\n      }\n\n      if (errorReason) {\n\n        let message = messages && messages[ key ] && messages[ key ][ errorReason ]\n        if (getType(message) !== 'string') {\n          message = this.messages[ rule.type ] && this.messages[ rule.type ][ errorReason ]\n        }\n\n        errors[key] = getType(message) === 'string'\n          ? message\n          : errorReason\n\n      }\n\n    }\n\n    if (Object.keys(errors).length > 0) {\n      return errors\n    }\n\n  }\n\n}\n"],"names":["const","PATTERN_DATE","PATTERN_DATE_TIME","getType","value","Object","prototype","toString","call","toLowerCase","slice","extend","source","props","let","key","checkInteger","rule","hasOwnProperty","min","max","checkNumber","isNaN","checkString","empty","length","pattern","test","checkBoolean","checkEnum","values","indexOf","checkArray","itemType","i","checkObject","checkDate","type","newRule","checkDateTime","Validator","this","rules","int","integer","number","string","bool","boolean","enum","array","object","date","dateTime","messages","add","name","handler","validate","data","errors","Error","errorReason","required","message","keys"],"mappings":"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"}